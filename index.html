  </table>
     <button onclick="actualizarStock()">Actualizar Stock</button>
 
     <script>
         const accessToken = "APP_USR-8126512474803100-030816-143738dd4f5680f738d9f2f5ec946115-1983391879"; // Reemplaza con tu token real
         const userId = "1983391879"; // Reemplaza con tu ID de usuario real
       const proxyUrl = "http://localhost:3000/";
    <script>
     const accessToken = "APP_USR-8126512474803100-030816-143738dd4f5680f738d9f2f5ec946115-1983391879"; // Reemplaza con tu token real
     const userId = "1983391879"; // Reemplaza con tu ID de usuario real
     const proxyUrl = "http://localhost:3000/";
 
         async function actualizarStock() {
             try {
                 let tableBody = document.getElementById("stockTable");
                 tableBody.innerHTML = '<tr><td colspan="3">Cargando productos...</td></tr>';
     async function actualizarStock() {
         try {
             let tableBody = document.getElementById("stockTable");
             tableBody.innerHTML = '<tr><td colspan="3">Cargando productos...</td></tr>';
 
                 // Obtener todos los productos automáticamente
                 let response = await fetch(`${proxyUrl}https://api.mercadolibre.com/users/${userId}/items/search?limit=50`, {
                     method: "GET",
                     headers: {
                         "Authorization": `Bearer ${accessToken}`,
                         "Content-Type": "application/json"
                     }
                 });
 
                 if (!response.ok) {
                     throw new Error("Error al obtener productos");
             // Obtener todos los productos automáticamente
             let response = await fetch(`${proxyUrl}productos`, {  // Aquí corregimos
                 method: "GET",
                 headers: {
                     "Content-Type": "application/json"
                 }
             });
 
                 let data = await response.json();
                 let productIDs = data.results; // Lista de IDs obtenidos
             if (!response.ok) {
                 throw new Error("Error al obtener productos");
             }
 
                 if (productIDs.length === 0) {
                     tableBody.innerHTML = '<tr><td colspan="3">No hay productos activos</td></tr>';
                     return;
                 }
             let data = await response.json();
             let productIDs = data.results; // Lista de IDs obtenidos
 
                 // Dividir los IDs en grupos de 20
                 let groups = [];
                 for (let i = 0; i < productIDs.length; i += 20) {
                     groups.push(productIDs.slice(i, i + 20));
                 }
             if (productIDs.length === 0) {
                 tableBody.innerHTML = '<tr><td colspan="3">No hay productos activos</td></tr>';
                 return;
             }
 
                 // Hacer múltiples solicitudes para obtener detalles de los productos
                 let requests = groups.map(group => {
                     let ids = group.join(",");
                     return fetch(`${proxyUrl}https://api.mercadolibre.com/items?ids=${ids}`, {
                         method: "GET",
                         headers: {
                             "Authorization": `Bearer ${accessToken}`,
                             "Content-Type": "application/json"
                         }
                     }).then(res => res.json());
                 });
             // Dividir los IDs en grupos de 20 (MercadoLibre permite máximo 20 por consulta)
             let groups = [];
             for (let i = 0; i < productIDs.length; i += 20) {
                 groups.push(productIDs.slice(i, i + 20));
             }
 
                 let responses = await Promise.all(requests);
             // Hacer múltiples solicitudes para obtener detalles de los productos
             let requests = groups.map(group => {
                 let ids = group.join(",");
                 return fetch(`${proxyUrl}productos/detalles?ids=${ids}`, {  // Aquí corregimos
                     method: "GET",
                     headers: { "Content-Type": "application/json" }
                 }).then(res => res.json());
             });
 
                 // Limpiar la tabla antes de agregar nuevos productos
                 tableBody.innerHTML = "";
             let responses = await Promise.all(requests);
 
                 // Mostrar todos los productos obtenidos
                 responses.forEach(products => {
                     Object.values(products).forEach(item => {
                         if (item.body && item.body.id) { // Verificamos que el producto tenga datos
                             let row = `<tr>
                                 <td>${item.body.id}</td>
                                 <td>${item.body.title}</td>
                                 <td>${item.body.available_quantity}</td>
                             </tr>`;
                             tableBody.innerHTML += row;
                         }
                     });
             // Limpiar la tabla antes de mostrar los productos
             tableBody.innerHTML = "";
 
             // Mostrar todos los productos obtenidos
             responses.forEach(products => {
                 products.forEach(item => {
                     if (item.body && item.body.id) {
                         let row = `<tr>
                             <td>${item.body.id}</td>
                             <td>${item.body.title}</td>
                             <td>${item.body.available_quantity}</td>
                         </tr>`;
                         tableBody.innerHTML += row;
                     }
                 });
             });
 
             } catch (error) {
                 console.error("Error al obtener datos:", error);
                 document.getElementById("stockTable").innerHTML = `<tr><td colspan="3" style="color: red;">Error al obtener productos</td></tr>`;
             }
         } catch (error) {
             console.error("Error al obtener datos:", error);
             document.getElementById("stockTable").innerHTML = `<tr><td colspan="3" style="color: red;">Error al obtener productos</td></tr>`;
         }
     </script>
     }
 </script>
 </body>
 </html>
